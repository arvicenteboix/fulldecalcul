---
# Front matter
# Metainformació del document
title: Estratègies per a l'ús del full de càlcul
titlepage: true
subtitle: Treballant amb el full de càlcul, relacions
author: 
- Alfredo Rafael Vicente Boix
lang: ca
page-background: img/bg.png

# portada
titlepage-rule-height: 2
titlepage-rule-color: AA0000
titlepage-text-color: AA0000
titlepage-background: ../portades/U3.png

# configuració de l'índex
toc-own-page: true
toc-title: Continguts
toc-depth: 2

# capçalera i peu
header-left: \thetitle
header-right: Curs 2023-2024
footer-left: CEFIRE València
footer-right: \thepage/\pageref{LastPage}

# Les figures que apareguen on les definim i centrades
float-placement-figure: H
caption-justification: centering 

# No volem numerar les linies de codi
listings-disable-line-numbers: true

# Configuracions dels paquets de latex
header-includes:

  #  imatges i subfigures
  - \usepackage{graphicx}
  - \usepackage{subfigure}
  - \usepackage{lastpage}



  #  - \usepackage{adjustbox}
  # mar| ca d'aigua   #- \usepackage{draftwatermark}
 # - \SetWatermarkText{\includegraphics{./img/Markdown.png}}
  #- \SetWatermarkText{Per revisar}
  #- \SetWatermarkScale{.5}
  #- \SetWatermarkAngle{20}
   
  # caixes d'avisos 
  - \usepackage{awesomebox}

  # text en columnes
  - \usepackage{multicol}
  - \setlength{\columnseprule}{1pt}
  - \setlength{\columnsep}{1em}

  # pàgines apaïsades
  - \usepackage{pdflscape}
  
  # per a permetre pandoc dins de blocs Latex
  - \newcommand{\hideFromPandoc}[1]{#1}
  - \hideFromPandoc {
      \let\Begin\begin
      \let\End\end
    }
 
# definició de les caixes d'avis
pandoc-latex-environment:
  noteblock: [note]
  tipblock: [tip]
  warningblock: [warning]
  cautionblock: [caution]
  importantblock: [important]
...

\vspace*{\fill}

![](img/cc.png){ height=50px }

Aquest document està subjecte a una llicència creative commons que permet la seua difusió i ús comercial reconeixent sempre l'autoria del seu creador. Aquest document es troba per a ser modificat al següent repositori de github:
<!-- CANVIAR L'ENLLAÇ -->
[https://github.com/arvicenteboix/fulldecalcul](https://github.com/arvicenteboix/fulldecalcul)
\newpage


# INTRODUCCIÓ

En esta unitat anem a seguir utilitzant funcions i veurem com poder traure relacions coincidents entre diferents rangs. Probablement esta siga la unitat més complexa de totes, ja que utilitzarem funcions d'una manera bastant avançada. Però no vos preocupeu que a la tasca vos demanarem exactament el que hem fet ací.

Partirem del full en el qual estem treballant, aquest full ens està relacionant criteris d'avaluació amb competències específiques (no vos estem demanant que seguiu la normativa, insistim que sempre podeu adaptar les entregues a la vostra realitat).

Així, una de les coses que veurem en aquest cas, és... Què passa si tenim més d'un criteri d'avaluació que es repetix en diferents situacions d'aprenentatge? Volem tindre una llista on estiguen totes les qualificacions reflectides. Pues és precisament això el que veurem en aquest mòdul. Per això parlem de relacions, anem a relacionar dades entre elles.

La unitat té una primera part que ens permetrà resoldre fer la fórmula amb Libreoffice Calc, podeu seguir el mateix procediment amb Excel. Després farem el mateix procediment amb ajuda de Copilot, un assistent GPT de Microsoft, on podrem veure les seues possibilitats i les limitacions. Al mateix temps, introduirem algunes de les diferències que presenta Excel respecte a Libreoffice Calc, i en aquest cas amb Excel pot ser més senzill.

# Introducció teòrica

És possible que no entengueu aquesta introducció teòrica, però és important que tingueu clar el concepte que anem a tractar. Cal conèixer els conceptes teòrics del que estem fem, si apliquem la fórmula suma, per exemple, és perquè sabem que els valors que estem sumant han de sumar-se.

## Buscar coincidències

En el nostre cas imaginem-nos que tenim el següent full amb un criteri d'avaluació (CA 1.1) que es repetix diverses vegades, hauríem de buscar el valor que té eixa qualificació i posar tots els valors seguits en una línia.

![Full de càlcul](img/1.png){ width=70% }

I com farem eixa búsqueda? Comparem dos files, en primer lloc afegirem el número de columna al rang on tenim tots els criteris, per exemple:

| Línia criteris | CA 1.1 | CA 1.2 | CA 2.1 | CA 2.4 | CA 1.5 | CA 1.1 | CA 1.2 | CA 1.1 | CA 2.2 | CA 2.3 | CA 1.4 | CA 1.7 |
| -- | - | - | - | - | - | - | - | - | - | - | - | - | - |
| Criteri+nº columna | CA 1.11 | CA 1.22 | CA 2.13 | CA 2.44 | CA 1.55 | CA 1.16 | CA 1.27 | CA 1.18 | CA 2.29 | CA 2.310 | CA 1.411 | CA 1.712 |

:::info
Fixem-nos que el que estem fent és afegir a la cel·la de cada criteri el número de columna on està.
:::

I, per altra banda afegirem al criteri que estem buscant (CA 1.1) també el número de columna:

| Criteri | CA 1.1 |  CA 1.1 | CA 1.1 | CA 1.1 | CA 1.1 | CA 1.1 | CA 1.1 | CA 1.1 | CA 1.1 | CA 1.1 | CA 1.1 | CA 1.1 |
| -- | - | - | - | - | - | - | - | - | - | - | - | - | - |
| Criteri+nº columna | CA 1.11 | CA 1.12 | CA 1.13 | CA 1.14 | CA 1.15 | CA 1.16 | CA 1.17 | CA 1.18 | CA 1.19 | CA 1.110 | CA 1.111 | CA 1.112 |

:::info
Fixem-nos que el que estem fent és afegir a cada criteri el número de columna on està i ho repetim 12 vegades.
:::

Si comparem ambdós:

| **CA 1.11** | CA 1.22 | CA 2.13 | CA 2.44 | CA 1.55 | **CA 1.16** | CA 1.27 | **CA 1.18** | CA 2.29 | CA 2.310 | CA 1.411 | CA 1.712 |
| - | - | - | - | - | - | - | - | - | - | - | - | - |
| **CA 1.11** | CA 1.12 | CA 1.13 | CA 1.14 | CA 1.15 | **CA 1.16** | CA 1.17 | **CA 1.18** | CA 1.19 | CA 1.110 | CA 1.111 | CA 1.112 |

Podem veure que els valors coincidents són els valors que es repetixen. En aquest cas tenim que la columna 1, 6 i 8 contenen els criteris d'avaluació que es repetixen.

:::warning
Hi han moltes maneres d'extraure els valors, aquesta és només una d'exemple. El raonament s'ha seguit basant-se en les fórmules que es coneixen. Cal pensar que existeixen al voltant de 400 fórmules en qualsevol full de càlcul.
:::

## Implementació al full de càlcul

Les fórmules que anem a introduir per a aconseguir aquest propòsit són les següents:

1. **K.ENESIMO.MENOR**: Aquesta funció retorna el k-èsim valor més petit d'un conjunt de dades. La seva sintaxi és `K.ENESIMO.MENOR (matriu;k)`, on `matriu` és l'array o rang de dades numèriques del qual vols determinar el k-èsim valor més petit, i `k` és la posició, dins de l'array o rang de dades, dels dades que es retornaran, determinada a partir dels valors més petits.

2. **K.ENESIMO.MAYOR**: Aquesta funció retorna el k-èsim valor més gran d'un conjunt de dades. La seva sintaxi és `K.ENESIMO.MAYOR (matriu;k)`, on `matriu` és l'array o rang de dades del qual vols determinar el k-èsim valor més gran, i `k` és la posició (a partir del valor més gran), dins de l'array o rang de cel·les, de les dades que es retornaran.

3. **AGREGAR**: Aquesta funció retorna un agregat en una llista o base de dades. Pot aplicar diferents funcions d'agregació a la llista o base de dades, amb l'opció d'ometre les files ocultes i els valors d'error. La seva sintaxi és `AGREGAR (núm_funció; opcions; ref1; [ref2]; …)` per a la forma de referència, i `AGREGAR (núm_funció, opcions, matriu, [k])` per a la forma matricial.

4. **\&**: Encara que no es tracte d'una funció pròpiament dita, aquesta expressió ens serveix per a concatenar valors. Per exemple, si tenim els següents valors:

```
A1: "Hola"
A2: 5
A3: =A1\&A2
```
El resultat de A3 serà Hola5.

Bé aquestes són totes les definicions dels manuals, però anem a analitzar cadascuna d'elles amb un exemple:

### K.ENESIMO.MENOR i K.ENESIMO.MAYOR

En el següents exemples podem extraure el segon valor més xicotet del següent llistat, o el segon valor més gran.

![Segon valor més gran](img/2.png){ width=70% }


![Segon valor més xicotet](img/3.png){ width=70% }

Podem afegir la fórmula SI.ERROR per a que ens done un altre valor en cas que demanem algun valor que no està a la llista:

![Amb SI.ERROR](img/4.png){ width=70% }

Si el llistat que agafem té una cel·la amb error ens tornarà un error.

### AGREGAR

La funció `AGREGAR` a Excel és una funció auxiliar que ens ajuda a implementar altres funcions d'Excel com són `PROMEDIO`, `SUMAR` ,`CONTAR`, `K.ENESIMO.MENOR` y mayor, etc... però fent que aquestes funcions no prenguin en compte els errors.

La sintaxi de la funció `AGREGAR` és la següent: `AGREGAR (núm_funció; opcions; ref1; [ref2]; …)`. Cal conèixer les taules de les funcions que pot utilitzar la funció agregar ja que cada funció ve representada per un número (nú,_funció). Així tenim que la fórmula `AGREGAR` pot utilitzar les següents funcions[^1],

[^1]: https://help.libreoffice.org/7.0/es/text/scalc/01/func_aggregate.html?DbPAR=CALC#bm_id126123001625791

| Núm_funció | Funció |
| --- | --- |
| 1 | PROMEDIO |
| 2 | CONTAR |
| 3 | CONTARA |
| 4 | MAX |
| 5 | MIN |
| 6 | PRODUCTO |
| 7 | DESVEST.M |
| 8 | DESVEST.P |
| 9 | SUMA |
| 10 | VAR.M |
| 11 | VAR.P |
| 12 | MEDIANA |
| 13 | MODA.UNO |
| 14 | **K.ESIMO.MAYOR** |
| 15 | **K.ESIMO.MENOR** |
| 16 | PERCENTIL.INC |
| 17 | CUARTIL.INC |
| 18 | PERCENTIL.EXC |
| 19 | CUARTIL.EXC |

I aquí tenim les opcions que podem utilitzar:

| Opció | Comportament |
| --- | --- |
| 0 o omitit | Omet funcions AGREGAR i SUBTOTALES anidades |
| 1 | Omet files ocultes i funcions AGREGAR i SUBTOTALES anidades |
| 2 | Omet valors d'error i funcions AGREGAR i SUBTOTALES anidades |
| 3 | Omet files ocultes, valors d'error i funcions AGREGAR i SUBTOTALES anidades |
| 4 | No omet res |
| 5 | Omet files ocultes |
| 6 | Omet valors d'error |
| 7 | Omet files ocultes i valors d'error |


Per exemple, si tens el següent rang de cel·les a la columna A i la funció `CONTAR` fent un recompte de les cel·les que conformen el rang:

```excel
A1: 1
A2: 2
A3: DIV/0
A4: 4
A5: 5
```

Si ocultes la fila 4, la funció `CONTAR` seguirà retornant com a resultat el valor 5. No obstant això, si vols que la funció `CONTAR` no prengui en compte les cel·les ocultes, llavors pots utilitzar la funció `AGREGAR` i executar la funció `CONTAR` sense considerar la fila oculta:

```excel
=AGREGAR(2;5;A1:A5)
```

En aquest cas, la funció `AGREGAR` està executant la funció `CONTAR` (que es representa amb el número 2 en el primer argument de la funció `AGREGAR`) sobre el rang A1:A5, però està ignorant les cel·les ocultes (que es representa amb el número 5 en el segon argument de la funció `AGREGAR`). Com a resultat, la funció `AGREGAR` retornarà el valor 4, ja que està comptant només les cel·les visibles.

Una vegada vist este exemple, anem a centrar-nos en la fórmula K.ESIMO.MENOR a nostre full de càlcul, que correspon al número 15. Volem que els valors que agafem (aquells que corresponen a ref1), s'ometen els valors no vàlids. A continuació, passem a vore un nou exemple. En este tindríem el mateix que tenim amb el valor K.ESIMO.MENOR, pero hem agafat l'opció 6, per tant el valor no vàlid no el tindrà en compte:

![Funció AGREGAR](img/6.png){ width=70% }

Ho vorem amb més detall a l'exemple del full de càlcul.

### COINCIDIR

Recordem que COLUMNA ens tornava el número on es trobava una cel·la, si passem un rang, ens tornarà un llistat de números on es troba cada cel·la:

![Funció COLUMNA](img/8.png){ width=70% }

Ací podem veure que ens torna {6.7.8.9} que són les posicions de les columnes, el resultat que ens mostra al full de càlcul és el 6 que és el primer número del llistat.

En aquest cas veurem que COINCIDIR en realitat no ens torna un valor, sino un llistat de números. 

![Funció AGREGAR](img/7.png){ width=90% }

Recordem que la formulació de és COINCIDIR("Criteri de búsqueda","Matriu de búsqueda", 0 per a valor exacte), en aquest cas tenim els següents valors:

* Criteri de búsqueda: \$M\$5\&COLUMNA($A2:$L2) unim el valor "CA 1.1" als números de les columnes
* Matriu de búsqueda: \$A2:\$L2\&COLUMNA($A2:$L2) unim el valor dels criteris CA 1.1	CA 1.2	CA 2.1... als número de les columnes:

Tenint aquests resultats:

| Criteri de búsqueda | **CA 1.11** | CA 1.22 | CA 2.13 | CA 2.44 | CA 1.55 | **CA 1.16** | CA 1.27 | **CA 1.18** | CA 2.29 | CA 2.310 | CA 1.411 | CA 1.712 |
| ---- | - | - | - | - | - | - | - | - | - | - | - | - | - |
| Matriu de búsqueda | **CA 1.11** | CA 1.12 | CA 1.13 | CA 1.14 | CA 1.15 | **CA 1.16** | CA 1.17 | **CA 1.18** | CA 1.19 | CA 1.110 | CA 1.111 | CA 1.112 |

A la imatge podem veure que el resultat de COINCIDIR és: {**1**.#N/D.#N/D.#N/D.#N/D.**6**.#N/D.**8**.#N/D.#N/D.#N/D.#N/D}, que el resultat de la comparació de les dos llistes anteriors, els valors que coincideixen deixen el número de columna i els que no coincideixen ens sur **#N/D** qeu significa NO DISPONIBLE.

# Full de càlcul 

Ara anem a posar-ho tot junt, però per a simplificar la nostra comprensió, hem decidit donar noms als rangs. Així partirem del següent full de càlcul amb els següents noms:

![Noms de rangs](img/9.png){ width=90% }

:::caution
Sempre és recomanable anar poc a poc. En fórmules llargues sempre hi ha alguna cosa susceptible d'error, per això cal tindre fulls intermedis fins que ja tens el teu full complet.
:::

## K.ESIMO.MENOR

En primer lloc tractarem de traure el següent llistat marcat amb un recuadre roig:

![K.ESIMO.MENOR](img/10.png){ width=90% }

Aquest recuadre en els trau la unió de els dos llistats de números:  

| Criteri de búsqueda | E8&COLUMNA(CRITERIS) |**CA 1.11** | CA 1.22 | CA 2.13 | CA 2.44 | CA 1.55 | **CA 1.16** | CA 1.27 | **CA 1.18** | CA 2.29 | CA 2.310 | CA 1.411 | CA 1.712 |
| ---- | -- | - | - | - | - | - | - | - | - | - | - | - | - | - |
| Matriu de búsqueda | CRITERIS&COLUMNA(CRITERIS) | **CA 1.11** | CA 1.12 | CA 1.13 | CA 1.14 | CA 1.15 | **CA 1.16** | CA 1.17 | **CA 1.18** | CA 1.19 | CA 1.110 | CA 1.111 | CA 1.112 |

Fixem-nos que estem comparant amb coincidir quines són de les dos files els valors iguals. En aquest cas en 1, 6 i 8, que aconseguim amb la fórmula COINCIDIR(E8&COLUMNA(CRITERIS)-2;CRITERIS&COLUMNA(CRITERIS)-2;0). K.ESIMO.MENOR ens trau el menor d'eixos 3 valors. Per a tal fi utilitzarem la següent fórmula:

```excel
=K.ESIMO.MENOR(COINCIDIR(E8&COLUMNA(CRITERIS)-2;CRITERIS&COLUMNA(CRITERIS)-2;0);1)
```

Fixeu-vos que tenim un -2 tant al Criteri com a la matriu de búsqueda. Això és perquè el nostre rang comença en la tercera columna, i volem ajustar-ho per a tindre el llistat amb de COLUMNA amb {1.2.3.4...}. Recordem que el 0 en la fórmula COINCIDIR és per a valor exacte i el 1 del final es per a traure el primer número més xicotet.

![Ajustos del lloc](img/11.png){ width=100% }

:::note
Hem triat K.ESIMO.MENOR enlloc de K.ESIMO.MAYOR, per a ordenar de menor a major. Si escollirem K.ESIMO.MAYOR ordenaríem de major a menor, o siga de l'última columna on apareix el Criteri a la primera.
:::

## AGREGAR

Canviant la fórmula d'abans a AGREGAR, recordem que K.ESIMO.MENOR és la fórmula 15 i li afegim l'opció 6, que es que no tinga en compte els valors no vàlids, per tant ens quedaria una fórmula:

```
=AGREGAR(15;6;COINCIDIR(E8&COLUMNA(CRITERIS)-2;CRITERIS&COLUMNA(CRITERIS)-2;0);1)
```

Podem veure el resultat ací:

![Ajustos del lloc](img/12.png){ width=70% }

Si anàrem canviant l'últim valor per 2 o 3, podríem veure com van canviant els valors al que està en segon lloc i al que està en tercer.

## Ajustos finals

Una de les coses que volem aconseguir és que al desplaçar la fórmula aquesta agafe tots els valors que tenim. Per tant, tindríem que anar canviant el valor del que parlàvem abans per a que vaja pujant automàticament. Això ho podem fer seleccionant una del·la `A1` per exemple i utilitzar la fórmula COLUMNA, de manera que al desplaçar la cel·la A1 passarà a A2 i així successivament, de manera que ens retornarà 1,2,3, etc...

:::tip
Si agafes A1, tracta que estiga buida, busca sempre una línia que no puga posar-te problemes com les cel·les unificades.
:::

![Ajustos del lloc](img/13.png){ width=80% }

Així la fórmula quedaría de la següent manera:

```excel
=AGREGAR(15;6;COINCIDIR($E8\&COLUMNA(CRITERIS)-2;CRITERIS\&COLUMNA(CRITERIS)-2;0);COLUMNA(A1))
```

Finalment només ens caldria afegir SI.ERROR per a que el valor que ens donara fos més legible.

# Excel

En aquesta unitat anem a parlar del mateix procediment però amb Excel. LibreOffice Calc és totalment compatible amb Excel, però no al revés. Excel presenta algunes diferències en la manera d'abordar les fórmules.

En aquest apartat seguirem el mateix procediment que hem seguit abans, crear-nos un full intermedi per a una fórmula tan gran però. Però introduirem l'ús de la intel·ligència artificial. En aquest cas utilitzarem Copilot, ja que, i es tracta d'una apreciació personal, és la que millor funciona per a programar.

## Copilot

Microsoft Copilot és un assistent d'intel·ligència artificial que proporciona respostes d'ús general, a més integra la tecnologia Wall-e per a crear imatges. Podem accedir a aquest assistent des de la següent pàgina: [https://copilot.microsoft.com/](https://copilot.microsoft.com/). Per a aquells que no estigueu familiaritzats en aquest tipus de tecnologies, heu de saber que les qüestions que se li plantegen a un assistent com pot ser Copilot o ChatGPT s'anomenen **prompts**. Nosaltres els representarem amb la següent icona:

\awesomebox[violet]{2pt}{\faRobot}{violet}{Lorem ipsum…}

Hem de tenir en compte que les respostes que donen les IA solen ser traduccions en anglès, i el Excel a EEUU té dos característiques que no tenim a Espanya:

* Les fórmules, òbviament, estan en anglès.
* Aquestes normalment es separen per ",". A Espanya es separem per ";".

## La nostra pàgina intermèdia 

Partim de la següent pàgina però anirem creant un prompt per a cada pas

![Pàgina de partida](img/17.png){ width=80% }

## FILA

Partim del següent prompt:

\awesomebox[violet]{2pt}{\faRobot}{violet}{Tenim un full de càlcul amb Excel amb un rang anomenat ALUMNES, en el rang es troben tots en una fila. A la celda C3 que ha de ser referència absoluta tenim un desplegable amb tots els noms dels alumnes. Fes-me una fórmula que em diga en quina fila es troba l'alumne seleccionat en C3. El Excel que estem utilitzant està a Espanya, per tant les fórmules han de ser en castellà i separades per punts i coma enlloc de per comes.}

La resposta:

![FILA](img/18.png){ width=80% }

Resposta pràcticament igual a la que teníem.

:::warning
Tot i que li hem demanat que siga una referència absoluta, no ens donat la referència absoluta a $C$3, per tant hem de revisar la fórmula per a corregir este coses.
:::

## COLUMNA

\awesomebox[violet]{2pt}{\faRobot}{violet}{Tenim un full de càlcul amb Excel amb un rang anomenat CRITERIS, en el rang es troben tots en una columna. A la celda E8 tenim el nom que busquem. Fes-me una fórmula que em diga en quina columna es troba l'alumne seleccionat en E8. Aquesta fórmula volem que s'autocomplete cap aval de manera que busque els criteris en E9, E10, etc...  El Excel que estem utilitzant està a Espanya, per tant les fórmules han de ser en castellà i separades per punts i coma enlloc de per comes.}

La resposta:

![COLUMNA](img/19.png){ width=80% }

## NOTA i SI.ERROR

Passem directament a la columna amb SI.ERROR.

\awesomebox[violet]{2pt}{\faRobot}{violet}{Tenim un full de càlcul amb Excel amb una cel·la a F8 on es troba el número de FILA que vull extraure i la cel·la G8 amb el número de columna que vull extraure d'un rang anomenat NOTES. Fes-me una fórmula m'estraiga el valor del rang donades esta fila i esta columna. Si torna un error vull que aparega el missatge "No avaluat". El Excel que estem utilitzant està a Espanya, per tant les fórmules han de ser en castellà i separades per punts i coma enlloc de per comes.}

La resposta:

![Amb SI.ERROR](img/20.png){ width=80% }

# TOT JUNT

\awesomebox[violet]{2pt}{\faRobot}{violet}{Tenim un full de càlcul on tenim una rang anomenat ALUMNES que va de B4:B13, i una rang anomenat CRITERIS que va de C3:N3, dins d'estos rangs, concretament en C4:N13 tenim un rang anomenat NOTES. Crea'm una fórmula que m'extraga el valor de NOTES donat un Alumne que es trobarà a la cel·la $C$3 i buscarà al rang ALUMNES i un valor de Criteri que es trobarà a la cel·la E8 i es buscarà al rang CRITERIS. SI el resultat que ens dóna és erroni vull que aparega el missatge "No avaluat". El Excel que estem utilitzant està a Espanya, per tant les fórmules han de ser en castellà i separades per punts i comes enlloc de per comes.}

La resposta:

![Tota la fórmula](img/21.png){ width=80% }

:::info
Fins ara tot anat molt bé i els resultats són bastant exactes al que anàvem buscant. Però cal anar amb compte ja que s'ha colat un INDEX a la fórmula, podem continuar la conversa i demanar que ens faça la fórmula amb totes les funcions en castellà. O ficar-nos i canviar-ho nosaltres.
:::

:::tip
Des d'un principi heu vist que hem donat un nom als rangs, això fa que ens resulte més senzill interpretar les fórmules que ens està donant, no és el mateix llegir ALUMNES que $'Alumnes'.B4:B10. Ens simplifica molt la tasca d'interpretar.
:::

# AGREGAR

Ací és on acaba el potencial dels assistents GPT. Els raonament que hem fet a la introducció teòrica és massa complexe per a una IA, tal vegada invertint més temps podríem aconseguir traure la fórmula. El que hem tractat de fer és le següent:

\awesomebox[violet]{2pt}{\faRobot}{violet}{Tenim un full de càlcul on tenim una rang anomenat ALUMNES que va de B4:B13, i una rang anomenat CRITERIS que va de C3:N3, dins d'estos rangs, concretament en C4:N13 tenim un rang anomenat NOTES on hi han el següents valors EX, NT, BE, SF, IN. Crea'm una fórmula que m'extraga el valor de NOTES donat un Alumne que es trobarà a la cel·la $C$3 i buscarà al rang ALUMNES i un valor de Criteri que es trobarà a la cel·la E8 i es buscarà al rang CRITERIS. Els criteris poden estar repetits així que vull extraure tots els valors de NOTES, utilitzant autocompletar, de manera que o escriuré la fórmula en una cel·la que em donarà el primer valor que trone de NOTES i al desplaçar la cel·la per a autocompletar en la segona cel·la em donarà el segon valor i així successivament.  SI el resultat que ens dóna és erroni o ja no hi han més valors vull que aparega el missatge "No avaluat". El Excel que estem utilitzant està a Espanya, per tant les fórmules han de ser en castellà i separades per punts i comes enlloc de per comes.}

![Resposta](img/22.png){ width=80% }

Si analitzem la resposta podem veure que algunes funcions no estan correctament traduïdes, per exemple K.ESIMO.MENOR en anglès és la fórmula SMALL que ho tradueix a PEQUEÑO.La fórmula correcta seria:

```
=SI.ERROR(INDICE(NOTES; K.ESIMO.MENOR(SI((ALUMNES=$C$3)*(CRITERIS=E8); FILA(NOTES)-MIN(FILA(NOTES))+1); FILA(A1))); "No avaluat")
```

Però, així i tot, no funciona. Per tant podem seguir intentant que funcione o podem tractar de fer-ho nosaltres.

## AGREGAR amb Excel

Un dels avantatges que ens dona Excel respecte a Libreoffice Calc és que ens permet comparar un rang de valors. Per exemple:

![Comparant rang de valors](img/23.png){ width=90% }

No hem autocompletat, és el resultat que ens dona directament la fórmula sobre E1, omplint totes les caselles de la dreta. D'aquesta manera podem veure quines són les columnes coincidents, i no ens cal fer la comparativa que hem fet abans. Cal anar amb compte de no tindre cel·les ocupades davant sinó ens dona un error, fixem-nos que a F1 hem posat la paraula "Emplenem":

![Comparant rang de valors. Error](img/24.png){ width=80% }

D'aquesta manera podem utilitzar la fórmula AGREGAR de la següent manera per a que ens done la posició dels valors:

```
=AGREGAR(15;6;SI(CRITERIS=$E$8;COLUMNA(CRITERIS);FALSO());COLUMNA(A1))-2
```
:::warning
Si ho fem d'aquesta manera i obrim este full de càlcul amb Libreoffice Calc no interepretarà bé la fórmula i no ens donarà el valor.
:::

Recordem:

* **15**: Funció K.ESIMO.MENOR
* **6**: Lleva els valors no vàlids
* **SI(CRITERIS=\$E\$8;COLUMNA(CRITERIS);FALSO())**: Ací tenim en rang que passem a K.ESIMO.MENOR. Fixem-nos que agafem els criteris
  * **CRITERIS=\$E\$8** -> {1	0	0	0	0	1	0	1	0	0	0	0}
  * **COLUMNA(CRITERIS)** -> Si és cert, o siga 1, tornarà el valor de la columna, per tant tindrem: {1	0	0	0	0	6	0	8	0	0	0	0}
  * **FALSO()** -> Si és fals tornarà el valor FALS, per tant: {1	FALS	FALS	FALS	FALS	6	FALS	8	FALS	FALS	FALS	FALS}
* Recordem que el valor 6 ens extreu els valors no vàlids, per tant tenim: {1 6 8}
* **COLUMNA(A1)**: Recordem que ho fem per a aconseguir el valor 1r, 2n i 3r, ja que al desplaçar per a fer el completament automàtic, COLUMNA(A1) és 1, COLUMNA(A2) és 2, etc...
* **-2**, és per a ajustar ja que el rang CRITERIS comença en la 3ª columna.

D'aquesta manera ja tenim les posicions on es troben els criteris. La fórmula final ens quedaría:

```
=SI.ERROR(INDICE(NOTES;COINCIDIR($C$3;ALUMNES;0);AGREGAR(15;6;SI(CRITERIS=$E8;COLUMNA(CRITERIS);FALSO());COLUMNA(A1))-2);"No avaluat")
```

Fixem-nos que de la matriu NOTES, aconseguim la fila amb la següent fórmula: 

```
COINCIDIR($C$3;ALUMNES;0)
```

La columna és la fórmula que hem extret ara:

```
AGREGAR(15;6;SI(CRITERIS=$E8;COLUMNA(CRITERIS);FALSO());COLUMNA(A1))-2)
```

:::tip
En aquest cas podem escalar tot el que volem la nostra pàgina, només ens cal canviar el rangs als que hem donat els noms. Un altre dels motius pels quals és importantn donar nom als rangs.
:::

# Conclusions

Aquest és el mòdul més complex ja que estem concatenant fórmules que és un dels pricipals avantatges d'utilitzar fulls de càlcul, els propers mòduls són molt més senzills i anem passar a una altre exemple, anem a preparar el pressupost per a una excursió, però cal tenir clares algunes estratègies per a buscar igualtats. Podem confiar que l'assistent Copilot ens ajude en algunes tasques, però les més complexes no. Hem vist que Excel presenta algunes diferències respecte a Libreoffice, ambdós solucions són vàlides, però cal tenir-ho en compte quan treballem amb els dos simultàniament.
